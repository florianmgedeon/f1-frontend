<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Live F1 Tracker</title>
  <style>
    body {
      background: #111;
      color: #00ff99;
      font-family: monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      gap: 4rem;
    }

    #map-container {
      position: relative;
    }

    svg#track {
      width: 800px;
      height: 800px;
      background: #000;
      border: 1px solid #333;
    }

    .column {
      display: flex;
      flex-direction: row;
      gap: 5rem;
    }

    .metric-block {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .label {
      font-size: 1.1rem;
      color: #aaa;
      margin-bottom: 0.2rem;
    }

    .value {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      color: #00ff99;
    }

    .gauge-container {
      position: relative;
      width: 200px;
      height: 200px;
    }

    .gauge-inner {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .speed-number {
      font-size: 2.2rem;
      color: #00ff99;
    }

    .speed-unit {
      font-size: 1rem;
      color: #00ff99;
    }

    canvas {
      width: 200px;
      height: 200px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <!-- ðŸš¦ TRACK MAP SVG -->
  <div id="map-container">
    <svg id="track" viewBox="0 0 800 800">
      <!-- âœ… PASTE YOUR SVG PATH HERE: -->
      <path d="M 593.54 185.54 L 586.53 189.59 L 573.20 197.32 L 559.04 205.51 L 557.39 206.44 L 545.57 213.33 L 532.78 220.70 L 520.82 227.58 L 510.52 233.56 L 496.63 241.78 L 491.55 245.49 L 484.95 250.71 L 477.94 256.33 L 469.00 263.27 L 461.31 269.28 L 454.85 274.27 L 450.17 277.80 L 438.08 287.04 L 432.71 290.89 L 428.45 293.45 L 422.68 296.46 L 413.06 300.07 L 403.44 302.26 L 395.88 303.25 L 395.19 303.34 L 379.93 303.98 L 366.46 303.48 L 354.50 302.99 L 343.92 302.84 L 326.87 303.95 L 322.47 304.80 L 315.46 307.51 L 313.95 308.94 L 313.54 310.45 L 313.54 311.77 L 314.23 314.04 L 314.36 314.51 L 315.19 316.31 L 317.53 319.87 L 319.31 322.15 L 321.79 324.77 L 324.67 327.60 L 329.35 331.97 L 331.41 334.16 L 333.88 337.02 L 336.36 340.60 L 337.73 343.34 L 338.69 348.86 L 338.01 351.83 L 335.81 357.14 L 331.82 364.37 L 329.76 367.69 L 325.09 375.24 L 319.45 384.52 L 317.80 387.26 L 315.33 391.19 L 309.97 399.97 L 304.33 409.19 L 301.03 415.08 L 299.93 417.26 L 298.56 421.02 L 297.59 423.82 L 296.22 426.91 L 290.72 430.70 L 285.77 432.19 L 270.52 434.44 L 257.87 435.57 L 247.42 436.48 L 234.91 437.73 L 226.12 438.81 L 215.53 440.47 L 202.89 443.13 L 198.35 444.32 L 183.51 449.28 L 175.53 453.04 L 170.45 456.45 L 165.36 461.99 L 164.40 464.67 L 164.12 467.42 L 165.22 472.23 L 167.56 475.32 L 171.55 478.70 L 178.56 482.46 L 193.40 488.23 L 203.44 492.20 L 208.52 494.88 L 213.88 499.96 L 215.12 504.56 L 212.51 511.09 L 205.64 517.57 L 202.75 519.81 L 192.30 527.13 L 186.39 529.81 L 174.02 533.31 L 154.36 535.91 L 134.02 538.39 L 116.43 543.02 L 110.38 546.32 L 104.74 553.14 L 103.37 559.85 L 103.64 564.92 L 104.74 569.21 L 107.08 573.35 L 111.48 577.64 L 123.44 583.79 L 137.73 587.93 L 152.03 590.73 L 169.62 593.29 L 187.22 595.39 L 194.64 596.27 L 212.10 598.43 L 236.43 603.06 L 249.62 608.16 L 257.04 614.03 L 259.66 617.15 L 263.37 621.69 L 266.53 625.11 L 274.09 631.61 L 278.63 635.11 L 287.97 641.78 L 292.92 645.37 L 299.38 650.65 L 302.27 653.56 L 306.80 659.92 L 309.83 665.11 L 312.44 669.89 L 313.13 671.21 L 316.56 679.14 L 318.35 684.06 L 319.59 688.15 L 320.69 693.13 L 321.10 696.78 L 321.10 700.92 L 320.55 705.55 L 319.86 710.63 L 318.90 716.20 L 317.94 721.30 L 316.01 729.67 L 314.50 736.17 L 314.09 737.57 L 312.16 745.91 L 310.52 753.29 L 308.87 758.83 L 306.39 764.75 L 302.96 770.08 L 299.79 774.19 L 295.95 778.68 L 289.35 784.60 L 283.30 788.31 L 274.09 792.07 L 259.52 795.74 L 240.55 798.48 L 230.65 799.33 L 212.65 800.00 L 208.38 799.97 L 185.70 798.54 L 166.87 795.60 L 156.84 793.06 L 145.15 788.37 L 139.52 783.99 L 137.32 781.11 L 136.36 778.98 L 136.08 772.50 L 138.14 767.25 L 140.62 763.93 L 142.41 762.24 L 148.32 757.89 L 155.05 754.31 L 161.79 751.65 L 174.16 747.43 L 183.09 744.45 L 197.39 739.35 L 205.22 736.14 L 214.71 731.27 L 216.63 730.11 L 226.25 721.65 L 229.69 716.17 L 232.30 709.75 L 232.85 706.72 L 230.79 694.91 L 226.25 688.79 L 222.54 685.32 L 210.58 677.21 L 198.35 671.00 L 182.82 663.86 L 169.35 657.33 L 160.82 652.37 L 154.09 647.47 L 149.42 642.86 L 145.70 637.99 L 143.78 635.37 L 137.32 629.54 L 132.37 627.21 L 125.22 624.87 L 112.99 622.39 L 103.78 621.26 L 85.09 620.15 L 63.37 619.48 L 49.90 618.37 L 39.31 616.68 L 27.08 613.53 L 20.34 611.20 L 16.63 609.65 L 7.70 603.73 L 2.34 596.36 L 0.41 590.14 L 0.27 589.04 L 0.00 581.40 L 0.82 575.10 L 2.34 570.32 L 3.99 567.08 L 7.42 562.21 L 10.31 558.94 L 19.66 551.19 L 26.53 546.70 L 39.04 539.79 L 47.15 535.70 L 53.75 532.44 L 69.42 524.57 L 71.07 523.75 L 78.63 519.49 L 86.32 514.71 L 92.51 510.31 L 98.83 504.88 L 105.98 496.87 L 108.87 492.23 L 111.07 487.04 L 112.58 480.86 L 112.99 477.50 L 114.36 470.33 L 116.56 464.12 L 121.65 455.49 L 130.31 445.98 L 134.98 442.22 L 142.68 437.12 L 153.68 431.20 L 174.02 422.57 L 186.12 418.28 L 204.26 411.93 L 217.59 406.74 L 226.53 402.74 L 233.95 399.10 L 249.07 389.77 L 257.46 382.59 L 264.05 375.33 L 268.04 369.53 L 270.10 365.62 L 272.58 359.82 L 274.23 352.00 L 273.95 345.39 L 272.30 338.33 L 270.93 334.66 L 267.90 328.91 L 263.23 322.03 L 260.07 317.68 L 258.83 315.99 L 256.22 311.53 L 255.40 309.05 L 255.95 305.15 L 258.56 302.84 L 267.63 299.05 L 276.43 296.89 L 290.45 294.39 L 300.76 292.61 L 312.03 290.65 L 340.07 285.49 L 353.13 281.67 L 355.46 280.77 L 363.02 276.78 L 370.31 268.67 L 372.10 264.85 L 373.33 260.59 L 373.75 256.31 L 371.55 249.54 L 365.22 242.31 L 356.15 236.45 L 347.35 232.16 L 337.73 227.93 L 327.70 223.74 L 320.27 220.64 L 308.18 215.57 L 299.79 212.04 L 282.34 204.43 L 271.20 199.07 L 261.03 193.56 L 251.82 187.43 L 245.09 181.63 L 241.79 177.96 L 237.25 170.08 L 236.29 166.32 L 236.01 162.59 L 237.53 154.22 L 241.79 146.20 L 247.29 139.61 L 254.43 132.56 L 266.39 122.20 L 277.11 113.22 L 284.67 107.07 L 295.67 99.05 L 304.47 93.42 L 315.19 87.45 L 329.07 81.18 L 339.24 77.24 L 356.29 71.32 L 375.12 65.67 L 396.84 59.83 L 420.07 54.32 L 446.46 48.72 L 460.07 46.04 L 476.15 42.86 L 489.48 40.21 L 494.43 39.22 L 517.94 34.55 L 541.86 30.06 L 563.02 26.39 L 578.97 23.76 L 605.50 19.54 L 620.76 17.09 L 638.35 14.32 L 650.03 12.45 L 667.63 9.68 L 686.46 6.71 L 696.91 5.04 L 719.73 1.52 L 727.70 0.67 L 739.79 0.00 L 759.04 0.29 L 766.46 0.82 L 773.20 1.57 L 782.82 3.15 L 788.04 4.37 L 792.71 5.92 L 794.50 6.65 L 798.63 9.42 L 800.00 11.75 L 799.73 13.88 L 797.39 17.26 L 794.78 19.94 L 788.32 26.01 L 783.78 30.44 L 780.62 33.56 L 777.04 37.15 L 771.96 42.75 L 768.80 46.16 L 761.24 53.80 L 756.01 58.75 L 752.58 62.02 L 749.42 64.97 L 740.62 73.28 L 736.63 77.15 L 730.17 83.07 L 726.74 86.28 L 718.08 94.45 L 710.38 101.94 L 706.12 106.20 L 696.91 115.24 L 687.97 123.52 L 681.79 128.77 L 675.60 133.61 L 670.24 137.57 L 664.60 141.54 L 652.10 149.96 L 641.10 157.11 L 628.04 165.30 L 616.77 172.10 L 612.92 174.34" fill="none" stroke="#00ff99" stroke-width="2"/>
    </svg>
  </div>

  <!-- ðŸ“Š TELEMETRY DATA -->
  <div class="column">
    <div class="column">
      <div class="metric-block">
        <div class="label">Position</div>
        <div id="position" class="value">--</div>
      </div>

      <div class="metric-block">
        <div class="label">Interval</div>
        <div id="interval" class="value">--</div>
      </div>

      <div class="metric-block">
        <div class="label">Lap Time</div>
        <div id="lap_time" class="value">--</div>
      </div>

      <div class="metric-block">
        <div class="label">Lap Delta</div>
        <div id="lap_delta" class="value">--</div>
      </div>
    </div>

    <div class="column">
      <div class="metric-block">
        <div class="label">Speed</div>
        <div class="gauge-container">
          <canvas id="speedGauge"></canvas>
          <div class="gauge-inner">
            <div id="speed-number" class="speed-number">--</div>
            <div class="speed-unit">km/h</div>
          </div>
        </div>
      </div>

      <div class="metric-block">
        <div class="label">Throttle</div>
        <div id="throttle" class="value">--</div>
        <canvas id="throttleChart"></canvas>
      </div>

      <div class="metric-block">
        <div class="label">Brake</div>
        <div id="brake" class="value">--</div>
        <canvas id="brakeChart"></canvas>
      </div>

      <div class="metric-block">
        <div class="label">Gear</div>
        <div id="gear" class="value">--</div>
        <canvas id="gearChart"></canvas>
      </div>
    </div>
  </div>

  <script type="module">
    import { dataBuffer, maxPoints, createChart } from './chart.js';

    const api = "https://f1-backend-production-f206.up.railway.app/api/live-data";
    const maxSpeed = 350;

    const speedGauge = new Chart(document.getElementById("speedGauge"), {
      type: 'doughnut',
      data: {
        datasets: [{
          data: [0, maxSpeed],
          backgroundColor: ['#00ff99', '#222'],
          borderWidth: 0,
          circumference: 270,
          rotation: 225,
          cutout: '80%',
        }]
      },
      options: {
        responsive: false,
        plugins: {
          legend: { display: false },
          tooltip: { enabled: false },
        }
      }
    });

    const charts = {
      throttle: createChart(document.getElementById('throttleChart'), 'Throttle'),
      brake: createChart(document.getElementById('brakeChart'), 'Brake'),
      gear: createChart(document.getElementById('gearChart'), 'Gear'),
    };

    function formatLapTime(seconds) {
      if (seconds === null) return "--";
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      const millis = Math.floor((seconds % 1) * 1000);
      return `${mins}:${secs.toString().padStart(2, '0')}.${millis.toString().padStart(3, '0')}`;
    }

    async function fetchLiveData() {
      try {
        const res = await fetch(api);
        if (res.status === 204) return;
        const data = await res.json();

        // Speed gauge
        document.getElementById('speed-number').textContent = data.speed;
        speedGauge.data.datasets[0].data[0] = data.speed;
        speedGauge.data.datasets[0].data[1] = maxSpeed - data.speed;
        speedGauge.update();

        // Other metrics
        document.getElementById('throttle').textContent = data.throttle;
        document.getElementById('brake').textContent = data.brake;
        document.getElementById('gear').textContent = data.n_gear;
        document.getElementById('position').textContent = data.position ? `#${data.position}` : '--';
        document.getElementById('lap_time').textContent = formatLapTime(data.lap_time);
        document.getElementById('interval').textContent = data.interval !== null
          ? `+${data.interval.toFixed(3)}`
          : '--';

        if (data.lap_delta !== null) {
          const prefix = data.lap_delta < 0 ? '-' : '+';
          document.getElementById('lap_delta').textContent = `${prefix}${Math.abs(data.lap_delta).toFixed(3)}`;
        } else {
          document.getElementById('lap_delta').textContent = '--';
        }

        ['throttle', 'brake', 'n_gear'].forEach(key => {
          const displayKey = key === 'n_gear' ? 'gear' : key;
          const value = data[key] || 0;

          dataBuffer[displayKey].push(value);
          if (dataBuffer[displayKey].length > maxPoints) {
            dataBuffer[displayKey].shift();
          }

          charts[displayKey].data.datasets[0].data = [...dataBuffer[displayKey]];
          charts[displayKey].update();
        });
      } catch (e) {
        console.error('Live data fetch error:', e);
      }
    }

    setInterval(fetchLiveData, 500);
  </script>
</body>
</html>
